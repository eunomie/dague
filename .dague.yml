go:
  image: golang:1.19.4-alpine3.17
  appDir: /go/src
  fmt:
    formatter: gofumpt
    goimports:
      locals:
        - github.com/docker
        - github.com/eunomie/dague

  lint:
    govulncheck:
      enable: true
    golangci:
      enable: true
      image: golangci/golangci-lint:v1.50.1

  build:
    targets:
      - &dague-build
        name: local
        type: local
        path: ./cmd/docker-dague
        out: ./dist
        env:
          CGO_ENABLED: 0
          GIT_COMMIT: !sh git describe --tags | cut -c 2-
        ldflags: -s -w -X 'github.com/eunomie/dague/internal.Version=${DAGUE_SET_VERSION}'
      - << : *dague-build
        name: cross
        type: cross
        platforms:
          - linux/amd64
          - linux/arm64
          - darwin/amd64
          - darwin/arm64
          - windows/amd64
          - windows/arm64